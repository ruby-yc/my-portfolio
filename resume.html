<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Page Title</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
   <object data="images/resume.pdf" type="application/pdf" width="100%" height="600px" class="pdf-embed"></object>
        <p>If this document can't be displayed in your browser. <a href="images/resume.pdf" target="_blank" download class="download-link">Download here</a></p>
</body>

<script>
let lastSentHeight = 0;
let stabilityCheckCount = 0;
let lastCheckedHeight = 0;

function sendHeight() {
    const height = Math.max(
        document.body.scrollHeight,
        document.documentElement.scrollHeight
    );
    
    if (height !== lastSentHeight) {
        lastSentHeight = height;
        console.log('子頁面發送高度:', height);
        parent.postMessage({ type: 'setHeight', height }, '*');
    }
}

// 檢查頁面是否穩定（高度不再變化）
function checkStability() {
    const currentHeight = Math.max(
        document.body.scrollHeight,
        document.documentElement.scrollHeight
    );
    
    if (currentHeight === lastCheckedHeight) {
        stabilityCheckCount++;
        // 連續 3 次檢查高度相同，認為頁面穩定
        if (stabilityCheckCount >= 3) {
            sendHeight();
            clearInterval(stabilityInterval);
            console.log(' stable, height confirm');
        }
    } else {
        stabilityCheckCount = 0;
        lastCheckedHeight = currentHeight;
    }
}

// 初始載入後等待頁面穩定
let stabilityInterval;
window.addEventListener('load', () => {
    // load 後等待 800ms 再開始檢查穩定性
    setTimeout(() => {
        stabilityCheckCount = 0;
        lastCheckedHeight = Math.max(
            document.body.scrollHeight,
            document.documentElement.scrollHeight
        );
        // 每 200ms 檢查一次，確保高度穩定
        stabilityInterval = setInterval(checkStability, 200);
    }, 800);
});

// 接收父頁面請求時發送
window.addEventListener('message', (event) => {
    if (event.data?.type === 'getHeight') {
        sendHeight();
    }
});
</script>

</html>